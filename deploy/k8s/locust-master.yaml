apiVersion: v1
kind: Service
metadata:
  name: locust-master
  labels:
    app: locust-master
spec:
  ports:
    - port: 8089
      targetPort: 8089
      name: web
    - port: 5557
      targetPort: 5557
      name: communication
  selector:
    app: locust-master
  type: LoadBalancer # 如果是在本地 Minikube 或云环境，可以使用 LoadBalancer 暴露 Web UI
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: locust-master
  labels:
    app: locust-master
spec:
  replicas: 1
  selector:
    matchLabels:
      app: locust-master
  template:
    metadata:
      labels:
        app: locust-master
    spec:
      containers:
        - name: locust-master
          image: my-locust-image:latest # 请替换为实际的镜像仓库地址
          imagePullPolicy: IfNotPresent
          args: ["--master"]
          ports:
            - containerPort: 8089
              name: web
            - containerPort: 5557
              name: communication
          env:
            - name: INFLUXDB_HOST
              value: "influxdb" # 假设 InfluxDB 部署在同 Namespace 下的服务名为 influxdb
            - name: LOCUST_MODE
              value: "master"
          resources:
            requests:
              cpu: "500m"
              memory: "512Mi"
            limits:
              cpu: "1000m"
              memory: "1Gi"
